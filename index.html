<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Molecular Clock Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .screen {
            display: none;
        }
        #screen1 {
            display: block;
        }
        /* Simple animation for screen transitions */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .screen {
            animation: fadeIn 0.5s ease-in-out;
        }
        /* New styles for the graphical cladogram */
        .cladogram {
            position: relative;
            padding-left: 20px;
            height: 250px;
        }
        .trunk {
            position: absolute;
            left: 0;
            top: 10px;
            height: 220px;
            width: 3px;
            background-color: #374151; /* gray-700 */
        }
        .branch {
            position: absolute;
            left: 0;
            display: flex;
            align-items: center;
            height: 20px;
        }
        .branch-line {
            height: 3px;
            background-color: #374151; /* gray-700 */
            border-radius: 2px;
        }
        .branch-label {
            padding-left: 10px;
            font-weight: 500;
        }
        .branch-c { top: 30px; }  /* Most distant, longest branch */
        .branch-b { top: 100px; } /* Middle */
        .branch-a { top: 170px; } /* Most recent, shortest branch */
        .human-line {
            position: absolute;
            left: 0;
            top: 230px;
            font-weight: bold;
            color: #1e40af; /* blue-800 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="max-w-4xl mx-auto my-8 p-6 bg-white rounded-xl shadow-lg">

        <!-- =================================== -->
        <!-- SCREEN 1: THE "CASE FILE"           -->
        <!-- =================================== -->
        <div id="screen1" class="screen">
            <h1 class="text-3xl font-bold text-blue-700 mb-2">The Molecular Clock Challenge ðŸ§¬</h1>
            <p class="text-lg text-gray-600 mb-6">You are a molecular biologist. Your team has just sequenced a 1,000 bp segment of a homologous pseudogene from three different species to determine their relationship to humans. Your job is to use this data to calculate <strong>when</strong> each species shared a common ancestor with humans and then build the correct phylogenetic tree.</p>
            
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-md">
                <h3 class="text-xl font-semibold text-blue-800 mb-2">Reference Data (The "Givens")</h3>
                <ul class="list-disc list-inside space-y-1 text-gray-700">
                    <li><strong>Sequence Length:</strong> 1,000 bp</li>
                    <li><strong>Known Mutation Rate:</strong> 1 x 10<sup>-9</sup> mutations per bp, per year (or 0.000000001)</li>
                    <li><strong>Species to Analyze:</strong> Mouse Lemur, Golden Tamarin, Dog</li>
                </ul>
            </div>
            <div class="mt-8 text-center flex flex-wrap justify-center gap-4">
                <button onclick="showScreen('screen2')" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition-transform transform hover:scale-105">Start the Analysis</button>
                <button onclick="showScreen('screen4', 'screen1')" class="bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-gray-700 transition-transform transform hover:scale-105">Concept Check</button>
                <button onclick="showScreen('screen5', 'screen1')" class="bg-teal-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-teal-700 transition-transform transform hover:scale-105">Molecular Clock Primer</button>
            </div>
        </div>

        <!-- =================================== -->
        <!-- SCREEN 2: THE "WORKBENCH"           -->
        <!-- =================================== -->
        <div id="screen2" class="screen">
            <h2 id="species-title" class="text-2xl font-bold text-indigo-700 mb-2">Species 1 of 3: Mouse Lemur</h2>
            <div id="species-data" class="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded-md text-gray-700 mb-6">After aligning the 1,000 bp sequences, you found <strong>150 mutations</strong> between the human and mouse lemur genes.</div>
            
            <h3 class="text-xl font-semibold mb-4">Interactive Calculation</h3>
            <p class="text-gray-600 mb-4">Fill in the blanks to complete the calculation.</p>

            <div class="space-y-4">
                <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <strong class="text-gray-700">Step 1: Find the "Sequence Rate"</strong> (mutations/sequence/year)
                    <p class="text-sm text-gray-500 mt-1 mb-2">(1.0 x 10<sup>-9</sup>) &times; (1,000 bp)</p>
                    <input type="text" id="calc_step1" placeholder="Enter calculated value" class="mt-1 block w-full md:w-1/2 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <strong class="text-gray-700">Step 2: Find the "Clock Tick Rate"</strong> (years/mutation)
                     <p class="text-sm text-gray-500 mt-1 mb-2">1 / (Answer from Step 1)</p>
                    <input type="text" id="calc_step2" placeholder="Enter calculated value" class="mt-1 block w-full md:w-1/2 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <strong class="text-gray-700">Step 3: Calculate Total Divergence Time</strong> (total years)
                    <p class="text-sm text-gray-500 mt-1 mb-2">(Answer from Step 2) &times; (<span id="mutation_count_label">150</span> mutations)</p>
                    <input type="text" id="calc_step3" placeholder="Enter calculated value" class="mt-1 block w-full md:w-1/2 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <strong class="text-gray-700">Step 4: Find the Common Ancestor</strong>
                    <p class="text-gray-600 my-2">The "Total Divergence Time" represents time along <strong>both</strong> lineages. What must you do to find the date of the single common ancestor?</p>
                    <div class="flex flex-col space-y-2">
                        <label class="flex items-center"><input type="radio" name="step4_op" value="multiply" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"> <span class="ml-2">Multiply by 2</span></label>
                        <label class="flex items-center"><input type="radio" name="step4_op" value="divide" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"> <span class="ml-2">Divide by 2</span></label>
                        <label class="flex items-center"><input type="radio" name="step4_op" value="nothing" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"> <span class="ml-2">Do nothing</span></label>
                    </div>
                </div>

                 <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <strong class="text-gray-700">Final Calculation</strong>
                    <p class="text-sm text-gray-500 mt-1 mb-2">(Answer from Step 3) / 2</p>
                    <input type="text" id="calc_step4" placeholder="Enter final answer in years" class="mt-1 block w-full md:w-1/2 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
            </div>

            <div class="mt-6 flex flex-wrap gap-2">
                <button onclick="resetApp()" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-gray-600 transition">Back to Start</button>
                <button onclick="checkCalculation()" class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 transition">Check Answers</button>
                <button id="nextSpeciesButton" onclick="nextSpecies()" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-indigo-700 transition" style="display:none;">Continue</button>
            </div>

            <div id="feedback-calc" class="mt-4 p-4 rounded-md" style="display:none;"></div>
        </div>

        <!-- =================================== -->
        <!-- SCREEN 3: THE "CLADOGRAM"           -->
        <!-- =================================== -->
        <div id="screen3" class="screen">
            <h2 class="text-2xl font-bold text-purple-700 mb-2">Final Step: Build the Phylogenetic Tree</h2>
            <p class="text-gray-600 mb-4">You have your divergence dates:</p>
            <div class="bg-purple-50 border-l-4 border-purple-500 p-4 rounded-md text-gray-700 mb-6">
                 <ul class="list-disc list-inside space-y-1">
                    <li><strong>Dog:</strong> 95,000,000 Years Ago</li>
                    <li><strong>Mouse Lemur:</strong> 75,000,000 Years Ago</li>
                    <li><strong>Golden Tamarin:</strong> 43,000,000 Years Ago</li>
                </ul>
            </div>

            <p class="text-gray-600 mb-4">Based on these dates, label the cladogram correctly. Which species is the most distant relative (C)? Which is the closest (A)?</p>

            <div class="md:flex md:items-start md:space-x-8">
                <div class="flex-shrink-0 mb-6 md:mb-0">
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 w-full md:w-72">
                        <div class="mb-4">
                            <label for="branchA" class="block font-medium text-gray-700">Branch A (Most Recent)</label>
                            <select id="branchA" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500">
                                <option value="">-- Select Species --</option>
                                <option value="Dog">Dog</option>
                                <option value="Lemur">Mouse Lemur</option>
                                <option value="Tamarin">Golden Tamarin</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="branchB" class="block font-medium text-gray-700">Branch B</label>
                            <select id="branchB" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500">
                                <option value="">-- Select Species --</option>
                                <option value="Dog">Dog</option>
                                <option value="Lemur">Mouse Lemur</option>
                                <option value="Tamarin">Golden Tamarin</option>
                            </select>
                        </div>
                        <div>
                            <label for="branchC" class="block font-medium text-gray-700">Branch C (Most Distant)</label>
                            <select id="branchC" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500">
                                <option value="">-- Select Species --</option>
                                <option value="Dog">Dog</option>
                                <option value="Lemur">Mouse Lemur</option>
                                <option value="Tamarin">Golden Tamarin</option>
                            </select>
                        </div>
                    </div>
                </div>
                 <!-- A new graphical cladogram -->
                <div class="flex-grow p-4 mt-4 md:mt-0">
                    <div class="cladogram">
                        <div class="trunk"></div>
                        <div class="branch branch-c">
                            <div class="branch-line" style="width: 150px;"></div>
                            <div class="branch-label text-gray-700">(C) Diverged 95 MYA</div>
                        </div>
                        <div class="branch branch-b">
                            <div class="branch-line" style="width: 100px;"></div>
                            <div class="branch-label text-gray-700">(B) Diverged 75 MYA</div>
                        </div>
                        <div class="branch branch-a">
                            <div class="branch-line" style="width: 50px;"></div>
                            <div class="branch-label text-gray-700">(A) Diverged 43 MYA</div>
                        </div>
                        <div class="human-line">â†’ Human Lineage</div>
                    </div>
                </div>
            </div>

            <div class="mt-8">
                <h3 class="text-xl font-semibold text-purple-800 mb-2">Explain Your Reasoning</h3>
                <p class="text-gray-600 mb-4">Explain <strong>why</strong> your arrangement is correct. How does the number of mutations relate to how <strong>recently</strong> a species shares a common ancestor with humans?</p>
                <textarea id="explanation-box" placeholder="Type your explanation here..." class="w-full h-28 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500"></textarea>
            </div>
            
            <div class="mt-6 flex flex-wrap justify-center gap-4">
                <button onclick="resetApp()" class="bg-gray-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-gray-600 transition">Back to Start</button>
                <button onclick="checkCladogram()" class="bg-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-purple-700 transition">Submit Final Lab</button>
                 <button onclick="showScreen('screen4', 'screen3')" class="bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-gray-700 transition">Concept Check</button>
            </div>
            <div id="feedback-final" class="mt-4 p-4 rounded-md" style="display:none;"></div>
        </div>
        
        <!-- =================================== -->
        <!-- SCREEN 4: CONCEPT CHECK             -->
        <!-- =================================== -->
        <div id="screen4" class="screen">
            <h2 class="text-2xl font-bold text-teal-700 mb-4">AP/IB Style Concept Check</h2>
            
            <!-- Question 1 -->
            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 mb-6">
                <p class="font-semibold mb-2">1. A scientist wants to construct a molecular clock to estimate the divergence of several mammal species over the last 20 million years. Which type of DNA sequence would provide the most reliable data?</p>
                <div class="flex flex-col space-y-2" id="q1_options">
                    <label class="flex items-center"><input type="radio" name="q1" value="A" class="h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500"> <span class="ml-2">A) The exons of an essential gene like actin, because its function is critical.</span></label>
                    <label class="flex items-center"><input type="radio" name="q1" value="B" class="h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500"> <span class="ml-2">B) A pseudogene that is no longer transcribed, because it can accumulate mutations without selective pressure.</span></label>
                    <label class="flex items-center"><input type="radio" name="q1" value="C" class="h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500"> <span class="ml-2">C) The gene for ribosomal RNA (rRNA), because it is highly conserved across all life.</span></label>
                    <label class="flex items-center"><input type="radio" name="q1" value="D" class="h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500"> <span class="ml-2">D) The middle region of an intron, because it is non-coding and thus not under selection.</span></label>
                </div>
                <button onclick="checkQuestion(1, 'B')" class="mt-4 bg-teal-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-teal-700 transition">Check Answer</button>
                <div id="q1_explanation" class="mt-4 p-3 rounded-md bg-teal-50 text-teal-900 border border-teal-200" style="display:none;"></div>
            </div>

            <!-- Question 2 -->
            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 mb-6">
                <p class="font-semibold mb-2">2. The table shows the number of nucleotide differences between a common ancestor and three descendant species in a selectively neutral DNA segment. Which statement is the most valid conclusion?</p>
                <table class="w-full my-2 text-left border-collapse">
                    <thead><tr><th class="border p-2">Comparison</th><th class="border p-2">Differences</th></tr></thead>
                    <tbody>
                        <tr><td class="border p-2">Ancestor vs. Species A</td><td class="border p-2">4</td></tr>
                        <tr><td class="border p-2">Ancestor vs. Species B</td><td class="border p-2">28</td></tr>
                        <tr><td class="border p-2">Ancestor vs. Species C</td><td class="border p-2">12</td></tr>
                    </tbody>
                </table>
                <div class="flex flex-col space-y-2" id="q2_options">
                    <label class="flex items-center"><input type="radio" name="q2" value="A" class="h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500"> <span class="ml-2">A) Species B is the most recently diverged from the ancestor.</span></label>
                    <label class="flex items-center"><input type="radio" name="q2" value="B" class="h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500"> <span class="ml-2">B) Species A and C are more closely related to each other than to Species B.</span></label>
                    <label class="flex items-center"><input type="radio" name="q2" value="C" class="h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500"> <span class="ml-2">C) Species A is the most closely related to the common ancestor.</span></label>
                    <label class="flex items-center"><input type="radio" name="q2" value="D" class="h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500"> <span class="ml-2">D) The rate of mutation was fastest in the lineage leading to Species B.</span></label>
                </div>
                <button onclick="checkQuestion(2, 'C')" class="mt-4 bg-teal-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-teal-700 transition">Check Answer</button>
                <div id="q2_explanation" class="mt-4 p-3 rounded-md bg-teal-50 text-teal-900 border border-teal-200" style="display:none;"></div>
            </div>

            <div class="mt-8 text-center flex flex-wrap justify-center gap-4">
                <button onclick="resetApp()" class="bg-gray-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-gray-600 transition">Back to Start</button>
                <button id="backButton" onclick="" class="bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-gray-700 transition">Back to Previous Page</button>
                <button onclick="showScreen('screen5', 'screen4')" class="bg-teal-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-teal-700 transition">Molecular Clock Primer</button>
            </div>
        </div>

        <!-- =================================== -->
        <!-- SCREEN 5: MOLECULAR CLOCK PRIMER    -->
        <!-- =================================== -->
        <div id="screen5" class="screen">
            <h2 class="text-2xl font-bold text-teal-700 mb-4">A Primer on Molecular Clocks</h2>
            
            <div class="space-y-6 text-gray-700">
                <div>
                    <h3 class="text-xl font-semibold text-teal-800 mb-2">The Core Principle: Selective Pressure</h3>
                    <p>The most reliable molecular clocks use sequences of DNA that are not being "seen" by natural selection. We want regions that are <strong>selectively neutral</strong>, meaning a mutation there has no effect on the organism's survival or reproduction.</p>
                    <p class="mt-2">Why? Because natural selection is not constant; it can speed up or slow down. Neutral mutations, however, are just random copying errors that occur at a relatively constant rate. By counting them, we are measuring <strong>time</strong>, not adaptation.</p>
                </div>

                <div>
                    <h3 class="text-xl font-semibold text-teal-800 mb-2">Comparing the "Clocks"</h3>
                    <p>Different parts of the genome accumulate mutations at different speeds, making them useful for measuring different evolutionary timescales.</p>
                    
                    <ul class="mt-4 space-y-4 list-disc list-inside">
                        <li><strong>Pseudogenes (The "Gold Standard"):</strong> These are "broken" or non-functional genes. Since they produce no protein, they are under almost zero selective pressure. They accumulate mutations at the fastest, most predictable rate, making them ideal for comparing <strong>closely related species</strong>.</li>
                        <li><strong>Introns (A "Fast" Clock):</strong> These are non-coding sequences *within* a gene that are spliced out before a protein is made. While mostly neutral, small regions essential for splicing are conserved. Biologists use the middle, neutral parts of introns as a fast-ticking clock.</li>
                        <li><strong>Exons (The "Slowest" Clock):</strong> These are the coding parts of a gene. They are under high selective pressure because a mutation could change the final protein.
                            <ul class="list-['-_'] list-inside ml-4 mt-2 space-y-2">
                                <li><em>Synonymous ("Silent") Mutations:</em> A base change that does not alter the resulting amino acid. These are more neutral and form a medium-speed clock.</li>
                                <li><em>Nonsynonymous Mutations:</em> A base change that alters the amino acid. These are often harmful and are removed by selection. These sites change very slowly and are used for measuring <strong>deep evolutionary time</strong> (e.g., comparing humans to fish).</li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-xl font-semibold text-teal-800 mb-2">Summary Table</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr>
                                    <th class="border p-2 bg-teal-50">DNA Region</th>
                                    <th class="border p-2 bg-teal-50">Selective Pressure</th>
                                    <th class="border p-2 bg-teal-50">"Clock Speed"</th>
                                    <th class="border p-2 bg-teal-50">Best for Measuring...</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td class="border p-2">Pseudogene</td><td class="border p-2">Almost None</td><td class="border p-2 font-semibold text-red-600">Fastest</td><td class="border p-2">Recent Divergence</td></tr>
                                <tr><td class="border p-2">Intron (middle)</td><td class="border p-2">Very Low</td><td class="border p-2 font-semibold text-orange-600">Fast</td><td class="border p-2">Recent Divergence</td></tr>
                                <tr><td class="border p-2">Exon (Synonymous)</td><td class="border p-2">Low-Medium</td><td class="border p-2 font-semibold text-yellow-600">Medium</td><td class="border p-2">Medium Divergence</td></tr>
                                <tr><td class="border p-2">Exon (Nonsynonymous)</td><td class="border p-2">Very High</td><td class="border p-2 font-semibold text-blue-600">Slowest</td><td class="border p-2">Deep Divergence</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="mt-8 text-center">
                <button id="primerBackButton" onclick="" class="bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-gray-700 transition">Back to Previous Page</button>
            </div>
        </div>

    </div>


    <!-- =================================== -->
    <!-- JAVASCRIPT: THE "BRAINS"            -->
    <!-- =================================== -->
    <script>
        // --- Global Data ---
        const speciesData = [
            { name: "Mouse Lemur", mutations: 150, step1: "1e-6", step2: "1000000", step3: "150000000", step4: "75000000" },
            { name: "Golden Tamarin", mutations: 86, step1: "1e-6", step2: "1000000", step3: "86000000", step4: "43000000" },
            { name: "Dog", mutations: 190, step1: "1e-6", step2: "1000000", step3: "190000000", step4: "95000000" }
        ];

        let currentSpeciesIndex = 0;

        // --- Navigation ---
        function showScreen(screenId, returnScreenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                 targetScreen.style.display = 'block';
            }
            // If going to a screen with a dynamic back button, set its destination
            if (screenId === 'screen4' && returnScreenId) {
                document.getElementById('backButton').onclick = () => showScreen(returnScreenId);
            }
             if (screenId === 'screen5' && returnScreenId) {
                document.getElementById('primerBackButton').onclick = () => showScreen(returnScreenId);
            }
        }

        function resetApp() {
            currentSpeciesIndex = 0;
            // Reset workbench screen to the first species
            const firstSpecies = speciesData[0];
            document.getElementById('species-title').innerText = `Species 1 of 3: ${firstSpecies.name}`;
            document.getElementById('species-data').innerHTML = `After aligning the 1,000 bp sequences, you found <strong>${firstSpecies.mutations} mutations</strong> between the human and ${firstSpecies.name} genes.`;
            document.getElementById('mutation_count_label').innerText = firstSpecies.mutations;

            // Clear all inputs on workbench
            document.getElementById('calc_step1').value = '';
            document.getElementById('calc_step2').value = '';
            document.getElementById('calc_step3').value = '';
            document.getElementById('calc_step4').value = '';
            const checkedRadioCalc = document.querySelector('input[name="step4_op"]:checked');
            if(checkedRadioCalc) checkedRadioCalc.checked = false;
            document.getElementById('feedback-calc').style.display = 'none';
            document.getElementById('nextSpeciesButton').style.display = 'none';

            // Clear all inputs on cladogram screen
            document.getElementById('branchA').value = '';
            document.getElementById('branchB').value = '';
            document.getElementById('branchC').value = '';
            document.getElementById('explanation-box').value = '';
            document.getElementById('feedback-final').style.display = 'none';

            // Clear all inputs on concept check screen
            const q1Radio = document.querySelector('input[name="q1"]:checked');
            if(q1Radio) q1Radio.checked = false;
            const q2Radio = document.querySelector('input[name="q2"]:checked');
            if(q2Radio) q2Radio.checked = false;
            document.getElementById('q1_explanation').style.display = 'none';
            document.getElementById('q2_explanation').style.display = 'none';

            // Finally, show the first screen
            showScreen('screen1');
        }
        
        // --- Screen 2 Logic ---
        function checkCalculation() {
            const currentSpecies = speciesData[currentSpeciesIndex];
            const feedbackEl = document.getElementById('feedback-calc');

            const ans1 = document.getElementById('calc_step1').value.replace('0.000001', '1e-6').toLowerCase();
            const ans2 = document.getElementById('calc_step2').value.replace(/,/g, '');
            const ans3 = document.getElementById('calc_step3').value.replace(/,/g, '');
            const ans4_radio = document.querySelector('input[name="step4_op"]:checked');
            const ans4 = document.getElementById('calc_step4').value.replace(/,/g, '').replace(' MYA', '');

            if (ans1 == currentSpecies.step1 && ans2 == currentSpecies.step2 && ans3 == currentSpecies.step3 && ans4_radio && ans4_radio.value === 'divide' && ans4 == currentSpecies.step4) {
                feedbackEl.innerHTML = `<strong class="font-bold">Correct!</strong> The common ancestor with the ${currentSpecies.name} lived <strong>${parseInt(currentSpecies.step4).toLocaleString()}</strong> years ago.`;
                feedbackEl.className = 'mt-4 p-4 rounded-md bg-green-100 text-green-800 border border-green-200';
                feedbackEl.style.display = 'block';
                document.getElementById('nextSpeciesButton').style.display = 'inline-block';
            } else {
                feedbackEl.innerHTML = "<strong class='font-bold'>Not quite.</strong> One or more of your calculations are incorrect. Please review your steps and try again.";
                feedbackEl.className = 'mt-4 p-4 rounded-md bg-red-100 text-red-800 border border-red-200';
                feedbackEl.style.display = 'block';
                document.getElementById('nextSpeciesButton').style.display = 'none';
            }
        }

        function nextSpecies() {
            currentSpeciesIndex++;
            
            if (currentSpeciesIndex < speciesData.length) {
                const newSpecies = speciesData[currentSpeciesIndex];
                document.getElementById('species-title').innerText = `Species ${currentSpeciesIndex + 1} of 3: ${newSpecies.name}`;
                document.getElementById('species-data').innerHTML = `After aligning the 1,000 bp sequences, you found <strong>${newSpecies.mutations} mutations</strong> between the human and ${newSpecies.name} genes.`;
                document.getElementById('mutation_count_label').innerText = newSpecies.mutations;

                document.getElementById('calc_step1').value = '';
                document.getElementById('calc_step2').value = '';
                document.getElementById('calc_step3').value = '';
                document.getElementById('calc_step4').value = '';
                const checkedRadio = document.querySelector('input[name="step4_op"]:checked');
                if(checkedRadio) checkedRadio.checked = false;

                document.getElementById('feedback-calc').style.display = 'none';
                document.getElementById('nextSpeciesButton').style.display = 'none';
            } else {
                showScreen('screen3');
            }
        }

        // --- Screen 3 Logic ---
        function checkCladogram() {
            const feedbackEl = document.getElementById('feedback-final');
            const ansA = document.getElementById('branchA').value;
            const ansB = document.getElementById('branchB').value;
            const ansC = document.getElementById('branchC').value;
            const explanation = document.getElementById('explanation-box').value;

            if (ansA === 'Tamarin' && ansB === 'Lemur' && ansC === 'Dog') {
                if (explanation.length < 30) {
                     feedbackEl.innerHTML = "<strong class='font-bold'>Labels are correct!</strong> Now, please write a full explanation for your reasoning in the text box.";
                     feedbackEl.className = 'mt-4 p-4 rounded-md bg-yellow-100 text-yellow-800 border border-yellow-200';
                } else {
                    feedbackEl.innerHTML = "<strong class='font-bold'>Lab Complete!</strong> Your cladogram is correct and your reasoning is sound. The Golden Tamarin had the <strong>fewest mutations</strong>, so it is our <strong>closest relative</strong> (most recent common ancestor). The Dog had the <strong>most mutations</strong>, making it the <strong>most distant relative</strong> of the group.";
                    feedbackEl.className = 'mt-4 p-4 rounded-md bg-green-100 text-green-800 border border-green-200';
                }
            } else {
                feedbackEl.innerHTML = "<strong class='font-bold'>Labels are incorrect.</strong> Check your divergence dates again. The species with the most recent common ancestor should have the *fewest* mutations.";
                feedbackEl.className = 'mt-4 p-4 rounded-md bg-red-100 text-red-800 border border-red-200';
            }
             feedbackEl.style.display = 'block';
        }
        
        // --- Screen 4 Logic ---
        const explanations = {
            q1: {
                correct: "<strong>Correct!</strong> A pseudogene is the best choice because it is the most selectively neutral. Mutations can accumulate at a steady, predictable rate without being removed by natural selection, making it an excellent molecular clock.",
                incorrect: "<strong>Not quite.</strong> While introns (D) are also good candidates, pseudogenes (B) are considered the 'gold standard' for neutrality. Exons (A) are under strong selection, and rRNA (C) changes far too slowly for this timescale. The correct choice is B because pseudogenes are almost completely free from natural selection."
            },
            q2: {
                correct: "<strong>Correct!</strong> The number of differences reflects the time since divergence. Species A has the fewest differences (4), meaning it diverged most recently and is therefore the most closely related to the common ancestor. Species B has the most differences (28), meaning it is the most distantly related.",
                incorrect: "<strong>Incorrect.</strong> Remember that the molecular clock assumes a roughly constant *rate* of mutation. Therefore, more differences implies more time has passed since divergence. The species with the *fewest* differences is the most closely related (C). Choice D is incorrect because the data doesn't provide information about the rate, only the accumulated number of changes."
            }
        };

        function checkQuestion(qNum, correctAns) {
            const selected = document.querySelector(`input[name="q${qNum}"]:checked`);
            const explanationEl = document.getElementById(`q${qNum}_explanation`);
            
            if (!selected) {
                explanationEl.innerHTML = "Please select an answer first.";
                explanationEl.style.display = 'block';
                return;
            }

            if (selected.value === correctAns) {
                explanationEl.innerHTML = explanations[`q${qNum}`].correct;
            } else {
                explanationEl.innerHTML = explanations[`q${qNum}`].incorrect;
            }
            explanationEl.style.display = 'block';
        }

    </script>

</body>
</html>

